<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<title>:::XVM:::</title>

		<link rel="stylesheet" href="styles/dynatree/ui.dynatree.css" type="text/css">
		<link rel="stylesheet" href="lib/Ol/theme/default/style.css" type="text/css">
		<link rel="stylesheet" href="styles/style_map.css" type="text/css">
		<link rel="stylesheet" href="styles/custom-theme/jquery-ui-1.9.1.custom.min.css" type="text/css">
		<script src="lib/jQuery/jquery-1.8.0.min.js"></script>
		<script src="lib/jQuery/jquery-ui-1.9.1.custom.min.js"></script>
		<script src="lib/Ol/OpenLayers.js"></script>
		<script src="lib/YAML/es5-shims.js"></script>
		<script src="lib/YAML/js-yaml.js"></script>
		<script src="lib/jQuery/jquery.dynatree.min.js"></script>
		<script src="lib/jQuery/jquery.i18n.js"></script>
		<script src="lib/jQuery/jquery.i18n.messages.js"></script>
		<script src="lib/jQuery/jquery.i18n.fallbacks.js"></script>
		<script src="lib/jQuery/jquery.i18n.parser.js"></script>
		<script src="lib/jQuery/jquery.i18n.emitter.js"></script>
		<script src="lib/jQuery/jquery.i18n.language.js"></script>
		<script src="src/XVM.js"></script>
		<script src="src/Class.js"></script>
		<script src="src/Map.js"></script>
		<script src="src/XVMUtils.js"></script>
		<script src="src/Loader/Reader.js"></script>
		<script src="src/Loader/Config.js"></script>
		<script src="src/Loader/Layers.js"></script>
		<script src="src/Loader/Controls.js"></script>
		<script src="src/Control/Control.js"></script>
		<script src="src/Control/ControlLoader.js"></script>
		<script src="src/Event/EventBus.js"></script>
		<link rel="localization" hreflang="en" href="config/text_en.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="es" href="config/text_es.json" type="application/l10n+json"/>
		<link rel="localization" hreflang="gl" href="config/text_gl.json" type="application/l10n+json"/>
		
		<!-- TOC  -->
		<script src="toc/src/TOC.js"></script>		
		<script src="toc/src/Class.js"></script>
		<script src="toc/src/Control.js"></script>

		<script type="text/javascript">
			$(document).ready(function() {
				get_features = function(set) {
					var features = null;
					if (set == 'current') {
						features = XVM.getMapCurrentFeatures('GJson');
					} else if (set == 'new') {
						features = XVM.getMapNewFeatures('GJson');
					} else if (set == 'updated') {
						features = XVM.getMapModifiedFeatures('GJson');
					} else if (set == 'deleted') {
						features = XVM.getMapDeletedFeatures('GJson');
					}
					if (features != null) {
						for (i in features) {
							var feat = features[i];
							var msg = null;
							if (feat.geometry.CLASS_NAME === 'OpenLayers.Geometry.Point') {
								msg = 'Point id : ' + feat.id + ' | coordinates x: ' + feat.geometry.x + ', y: ' + feat.geometry.y;
							}
							if (feat.geometry.CLASS_NAME === 'OpenLayers.Geometry.LineString') {
								msg = 'Line id : ' + feat.id;
								for (j = 0, leng = feat.geometry.components.length; j < leng; j++) {
									msg += ' | point ' + j + ' coordinates x: ' + feat.geometry.components[j].x + ', y: ' + feat.geometry.components[j].y;
								}
							}
							if (feat.geometry.CLASS_NAME === 'OpenLayers.Geometry.Polygon') {
								msg = 'Polygon id : ' + feat.id;
								var comp = feat.geometry.components[0].components;
								for (j = 0, leng = comp.length; j < leng; j++) {
									msg += ' | point ' + j + ' coordinates x: ' + comp[j].x + ', y: ' + comp[j].y;
								}
							}
							if (feat.geometry.CLASS_NAME === 'OpenLayers.Geometry.MultiPolygon') {
								msg = 'MultiPolygon id : ' + feat.id;
								for (var j = 0, leng = feat.geometry.components.length; j < leng; j++) {
									var comp = feat.geometry.components[j].components[0].components;
									msg += ' [ Polygon ' + j;
									for (k = 0, lengt = comp.length; k < lengt; k++) {
										msg += ' | point ' + k + ' coordinates x: ' + comp[k].x + ', y: ' + comp[k].y;
									}
									msg += ' ] ';
								}
							}
							if (msg != null) {
								alert(msg);
							}
						}
					}
				};
				XVM.createDefaultMap();
			});
		</script>
	</head>
	<body>
		<div id="map" class="smallmap"><div id="toc"></div></div>
		<input type="BUTTON" onclick="get_features('current')" value="Retrieve current features">
		<input type="BUTTON" onclick="get_features('new')" value="Retrieve new features">
		<input type="BUTTON" onclick="get_features('updated')" value="Retrieve modified features">
		<input type="BUTTON" onclick="get_features('deleted')" value="Retrieve deleted features">
		
	</body>
</html>